<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Canvas for Network visualization | 拾荒者</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="Downloads the demo exampleDownloads the latest source code from github">
<meta property="og:type" content="article">
<meta property="og:title" content="Canvas for Network visualization">
<meta property="og:url" content="http://blog.xieguigang.me/2016/06/06/net_canvas/index.html">
<meta property="og:site_name" content="拾荒者">
<meta property="og:description" content="Downloads the demo exampleDownloads the latest source code from github">
<meta property="og:image" content="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/Previews.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/net_test/xcb-main.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/tumblr_inline_mqvdlydGCp1qz4rgp.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/canvas_screenshot.png">
<meta property="og:image" content="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/canvas_screenshot.png">
<meta property="og:updated_time" content="2016-08-03T13:23:46.659Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Canvas for Network visualization">
<meta name="twitter:description" content="Downloads the demo exampleDownloads the latest source code from github">
<meta name="twitter:image" content="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/Previews.gif">
    

    
        <link rel="alternate" href="/" title="拾荒者" type="application/atom+xml" />
    

    
        <link rel="icon" href="http://xieguigang.me/favicon.ico" />
    

    <link rel="stylesheet" href="/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/vendor/open-sans/styles.css">
    <link rel="stylesheet" href="/vendor/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/vendor/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/vendor/fancybox/jquery.fancybox.css">
    
    
    
    

</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">拾荒者</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">Home</a>
                
                    <a class="main-nav-link" href="/archives">Archives</a>
                
                    <a class="main-nav-link" href="/nuget">nuget</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="https://raw.githubusercontent.com/xieguigang/xieguigang.github.io-hexo/master/images/my/WeChatImage636059681622385094.jpg" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜尋" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: 'Pages',
            CATEGORIES: '分類',
            TAGS: '標籤',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">Home</a></td>
                
                    <td><a class="main-nav-link" href="/archives">Archives</a></td>
                
                    <td><a class="main-nav-link" href="/nuget">nuget</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜尋" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="https://raw.githubusercontent.com/xieguigang/xieguigang.github.io-hexo/master/images/my/WeChatImage636059681622385094.jpg" />
            <h2 id="name">xieguigang</h2>
            <h3 id="title">GCModeller chief developer</h3>
            <span id="location"><i class="fa fa-map-marker"></i>GuiLin, China (中國 · 桂林)</span>
            <a id="follow" target="_blank" href="https://github.com/xieguigang">關注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                44
                <span>文章</span>
            </div>
            <div class="article-info-block">
                92
                <span>標籤</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="http://github.com/xieguigang" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main"><article id="post-net_canvas" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
            Canvas for Network visualization
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2016/06/06/net_canvas/">
            <time datetime="2016-06-05T16:00:00.000Z" itemprop="datePublished">2016-06-06</time>
        </a>
    </div>


                        
                        
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/d3js/">d3js</a>, <a class="tag-link" href="/tags/force-directed/">force directed</a>, <a class="tag-link" href="/tags/javascript/">javascript</a>, <a class="tag-link" href="/tags/my-works/">my works</a>, <a class="tag-link" href="/tags/vb-net/">vb.net</a>, <a class="tag-link" href="/tags/前端/">前端</a>
    </div>

                    </div>
                
            </header>
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <blockquote>
<p><a href="https://github.com/xieguigang/VisualBasic_AppFramework/releases/tag/v0.16-update" target="_blank" rel="external">Downloads the demo example</a><br><a href="https://github.com/xieguigang/VisualBasic_AppFramework/tree/master/Datavisualization/Datavisualization.Network" target="_blank" rel="external">Downloads the latest source code from github</a></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/Previews.gif" alt=""><br><a id="more"></a></p>
<p><img src="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/net_test/xcb-main.png" alt=""></p>
<h2 id="Introduction-and-background"><a href="#Introduction-and-background" class="headerlink" title="Introduction and background"></a>Introduction and background</h2><p>In my recent work on the GCModeller, I want to developing a module for the biological network data visualization.<br>One of the solution is using d3js for this data visualization and the another solution is the Cytoscape software.</p>
<p>The <a href="http://cytoscape.org/" target="_blank" rel="external">Cytoscape</a> software is doing the best in the network visualization as it provides a lot of style mapping and data imports and exports function. And in my recent work, the cytoscape software was used for visualize the biological network data frequently. But there is problem that the cytoscape software can only generate the statics image of the network, and just can only export a interactive output in web app format. And the cytoscape software is also can not programming with VB.NET. And as I want to build a inner interactive module for the biological network visualization, so that I should try another way for the job. There is another important tools for visualize the network data in the HTML programming: <a href="https://github.com/d3/d3" target="_blank" rel="external">d3js</a>. And the d3js is one of my favorite tools in the data visualization.</p>
<p>Here is my most favorite project from Mr. whichlight’s work: a project for visualize the reddit discussion network by using d3js.</p>
<blockquote>
<p><img src="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/tumblr_inline_mqvdlydGCp1qz4rgp.png" alt=""><br><a href="https://github.com/whichlight/reddit-network-vis" target="_blank" rel="external">Reddit Discussion Network Visualization</a></p>
</blockquote>
<p>And the d3js is my first choice in this work. And here is the force directed graphic engine that I write with d3js hybrid programming with VB.NET (whole source cdoe and example can be download from <a href="https://github.com/SMRUCC/GCModeller.Workbench/tree/master/d3js/Force-Directed%20Graph/js" target="_blank" rel="external">here</a>):</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">d3Network</span>(<span class="params">jsonFile, width, height</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> color = d3.scale.category20();</span><br><span class="line">    <span class="keyword">var</span> force = d3.layout.force()</span><br><span class="line">        .charge(<span class="number">-120</span>)</span><br><span class="line">        .linkDistance(<span class="number">30</span>)</span><br><span class="line">        .size([width, height]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> svg = d3.select(<span class="string">"body"</span>).append(<span class="string">"svg"</span>)</span><br><span class="line">        .attr(<span class="string">"fill"</span>, <span class="string">"#DBF3FF"</span>)</span><br><span class="line">        .attr(<span class="string">"width"</span>, width)</span><br><span class="line">        .attr(<span class="string">"height"</span>, height)</span><br><span class="line">        .attr(<span class="string">"class"</span>, <span class="string">"chart"</span>);</span><br><span class="line"></span><br><span class="line">    d3.json(jsonFile, <span class="function"><span class="keyword">function</span> (<span class="params">error, graph</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line"></span><br><span class="line">        force</span><br><span class="line">            .nodes(graph.nodes)</span><br><span class="line">            .links(graph.links)</span><br><span class="line">            .start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> link = svg.selectAll(<span class="string">".link"</span>)</span><br><span class="line">            .data(graph.links)</span><br><span class="line">            .enter().append(<span class="string">"line"</span>)</span><br><span class="line">            .attr(<span class="string">"class"</span>, <span class="string">"link"</span>)</span><br><span class="line">            .style(<span class="string">"stroke-width"</span>, <span class="number">0.5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> node = svg.selectAll(<span class="string">".node"</span>)</span><br><span class="line">            .data(graph.nodes)</span><br><span class="line">            .enter().append(<span class="string">"circle"</span>)</span><br><span class="line">            .attr(<span class="string">"class"</span>, <span class="string">"node"</span>)</span><br><span class="line">            .attr(<span class="string">"r"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(d.size)+<span class="number">1</span>;</span><br><span class="line">            &#125;)</span><br><span class="line">            .style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> color(d.group);</span><br><span class="line">            &#125;)</span><br><span class="line">            .style(<span class="string">"opacity"</span>, <span class="number">0.8</span>)</span><br><span class="line">            .call(force.drag);</span><br><span class="line"></span><br><span class="line">        node.append(<span class="string">"title"</span>)</span><br><span class="line">            .attr(<span class="string">"class"</span>, <span class="string">"tooltip"</span>)</span><br><span class="line">            .style(<span class="string">"font-size"</span>, <span class="number">16</span>)</span><br><span class="line">            .html(<span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"name:\t"</span> + d.name + <span class="string">"\ntype:\t"</span> + d.type + <span class="string">"\nlinks:\t"</span> + d.size;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">        force.on(<span class="string">"tick"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            link.attr(<span class="string">"x1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.x; &#125;)</span><br><span class="line">                .attr(<span class="string">"y1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.y; &#125;)</span><br><span class="line">                .attr(<span class="string">"x2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.x; &#125;)</span><br><span class="line">                .attr(<span class="string">"y2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.y; &#125;);</span><br><span class="line"></span><br><span class="line">            node.attr(<span class="string">"cx"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x; &#125;)</span><br><span class="line">                .attr(<span class="string">"cy"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y; &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The VB.NET language was programming hybrids with javascript as the server side on the local client. And by using WinForm web browser control, that we can display the network visualization data. But as the .NET Webbrowser control is based on the IE browser and not support d3js well, so that I have to changes the .NET Webbrowser control to the opensource Firefox browser or Google chrome. And by using Firefox in the project, it actually works, but the problem is that we needs deploy our application with the Chrome kernel(~100MB) and Firefox kernel(~50MB). This is not so convenient and friendly for my customer clients.</p>
<p>And after search on the github, I found a solution for this interactive network visualization work in the .NET language its own way.</p>
<p><img src="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/canvas_screenshot.png" alt=""></p>
<p>This network canvas library is majority based on the work of <a href="http://www.codeproject.com/Articles/833043/EpForceDirectedGraph-cs-A-D-D-force-directed-gra" target="_blank" rel="external">Mr. Woong Gyu La</a></p>
<h3 id="Overviews"><a href="#Overviews" class="headerlink" title="Overviews"></a>Overviews</h3><p>This canvas library is consist with 4 parts majority:</p>
<ol>
<li><a href="https://github.com/xieguigang/VisualBasic_AppFramework/blob/master/Datavisualization/Datavisualization.Network/Datavisualization.Network/Layouts/ForceDirected/Layout/ForceDirected.vb" target="_blank" rel="external">Force Directed layout engine</a></li>
<li><a href="https://github.com/xieguigang/VisualBasic_AppFramework/blob/master/Datavisualization/Datavisualization.Network/NetworkCanvas/Canvas.vb" target="_blank" rel="external">Canvas control for WinForm</a></li>
<li><a href="https://github.com/xieguigang/VisualBasic_AppFramework/blob/master/Datavisualization/Datavisualization.Network/NetworkCanvas/InputDevice.vb" target="_blank" rel="external">InputDevice for user mouse events</a></li>
<li><a href="https://github.com/xieguigang/VisualBasic_AppFramework/blob/master/Datavisualization/Datavisualization.Network/NetworkCanvas/Renderer.vb" target="_blank" rel="external">Renderer for the graphics rendering of the network data</a></li>
</ol>
<h3 id="Code-in-details"><a href="#Code-in-details" class="headerlink" title="Code in details"></a>Code in details</h3><h5 id="Force-Directed-layout-engine"><a href="#Force-Directed-layout-engine" class="headerlink" title="Force Directed layout engine"></a>Force Directed layout engine</h5><p>The force directed network layout engine which is available at type <a href="https://github.com/xieguigang/VisualBasic_AppFramework/blob/master/Datavisualization/Datavisualization.Network/Datavisualization.Network/Layouts/ForceDirected/Layout/ForceDirected.vb" target="_blank" rel="external"><strong>Microsoft.VisualBasic.DataVisualization.Network.Layouts.ForceDirected2D</strong></a><br>The introduction for this layout provider is available at Mr. Woong Gyu La’s article: <a href="http://www.codeproject.com/Articles/833043/EpForceDirectedGraph-cs-A-D-D-force-directed-gra" target="_blank" rel="external">“EpForceDirectedGraph.cs- A 2D/3D force directed graph algorithm in C#”</a></p>
<h5 id="Canvas-control-for-WinForm"><a href="#Canvas-control-for-WinForm" class="headerlink" title="Canvas control for WinForm"></a>Canvas control for WinForm</h5><p>The canvas control providers the user interface and rendering task thread for the layout engine.<br>Set up the network data just by using the <strong>Canvas.Graph</strong> property:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Public</span> <span class="keyword">Property</span> Graph <span class="keyword">As</span> NetworkGraph</span><br><span class="line">    <span class="keyword">Get</span></span><br><span class="line">        <span class="keyword">If</span> net <span class="keyword">Is</span> <span class="literal">Nothing</span> <span class="keyword">Then</span></span><br><span class="line">            <span class="keyword">Call</span> __invokeSet(<span class="keyword">New</span> NetworkGraph)</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">Return</span> net</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Get</span></span><br><span class="line">    <span class="keyword">Set</span>(value <span class="keyword">As</span> NetworkGraph)</span><br><span class="line">        <span class="keyword">Call</span> __invokeSet(value)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">Set</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Property</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> __invokeSet(g <span class="keyword">As</span> NetworkGraph)</span><br><span class="line">    net = g</span><br><span class="line">    fdgPhysics = <span class="keyword">New</span> ForceDirected2D(net, FdgArgs.Stiffness, FdgArgs.Repulsion, FdgArgs.Damping)</span><br><span class="line">    fdgRenderer = <span class="keyword">New</span> Renderer(</span><br><span class="line">        <span class="keyword">Function</span>() paper,</span><br><span class="line">        <span class="keyword">Function</span>() <span class="keyword">New</span> Rectangle(<span class="keyword">New</span> Point, Size),</span><br><span class="line">        fdgPhysics)</span><br><span class="line">    inputs = <span class="keyword">New</span> InputDevice(<span class="keyword">Me</span>)</span><br><span class="line">    fdgRenderer.Asynchronous = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>And these components is using for the layout engine and rendering of the image:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> The network data model for the visualization</span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">Dim</span> net <span class="keyword">As</span> NetworkGraph</span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> Layout provider engine</span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">Protected</span> <span class="keyword">Friend</span> fdgPhysics <span class="keyword">As</span> ForceDirected2D</span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> The graphics updates thread.</span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">Protected</span> <span class="keyword">Friend</span> timer <span class="keyword">As</span> <span class="keyword">New</span> UpdateThread(<span class="number">30</span>, <span class="keyword">AddressOf</span> __invokePaint)</span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> The graphics rendering provider</span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">Protected</span> <span class="keyword">Friend</span> fdgRenderer <span class="keyword">As</span> Renderer</span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> GDI+ interface for the canvas control.</span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">Dim</span> paper <span class="keyword">As</span> Graphics</span><br></pre></td></tr></table></figure>
<p>All of the rendering work is starting from the <strong>timer</strong> object:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> The graphics updates thread.</span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">Protected</span> <span class="keyword">Friend</span> timer <span class="keyword">As</span> <span class="keyword">New</span> UpdateThread(<span class="number">30</span>, <span class="keyword">AddressOf</span> __invokePaint)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Private</span> <span class="keyword">Sub</span> __invokePaint()</span><br><span class="line">    <span class="keyword">Call</span> <span class="keyword">Me</span>.Invoke(<span class="keyword">Sub</span>() Invalidate())</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>By notifying the Windows message that the control needs to be update in periodic in the timer thread, and then the event <strong>Paint</strong> will be trigged, and then we are able to use the graphics gdi+ interface in the rendering engine for the network visualization. As you can see, this event function provides the required gdi+ interface for the rendering engine and invoke updates the network layout and the control graphics image.</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Canvas_Paint(sender <span class="keyword">As</span> <span class="built_in">Object</span>, e <span class="keyword">As</span> PaintEventArgs) <span class="keyword">Handles</span> <span class="keyword">Me</span>.Paint</span><br><span class="line">    paper = e.Graphics</span><br><span class="line">    paper.CompositingQuality = Drawing2D.CompositingQuality.HighQuality</span><br><span class="line">    paper.SmoothingMode = Drawing2D.SmoothingMode.HighQuality</span><br><span class="line"></span><br><span class="line">    <span class="keyword">Call</span> fdgRenderer.Draw(<span class="number">0.05</span>F)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>Here is the same function that implements in javascript:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">force.on(<span class="string">"tick"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">     link.attr(<span class="string">"x1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.x; &#125;)</span><br><span class="line">         .attr(<span class="string">"y1"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.source.y; &#125;)</span><br><span class="line">         .attr(<span class="string">"x2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.x; &#125;)</span><br><span class="line">         .attr(<span class="string">"y2"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.target.y; &#125;);</span><br><span class="line"></span><br><span class="line">     node.attr(<span class="string">"cx"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.x; &#125;)</span><br><span class="line">         .attr(<span class="string">"cy"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123; <span class="keyword">return</span> d.y; &#125;);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure></p>
<h5 id="InputDevice-for-user-mouse-events"><a href="#InputDevice-for-user-mouse-events" class="headerlink" title="InputDevice for user mouse events"></a>InputDevice for user mouse events</h5><p>The graphics node in the d3js visualization can be drag by the mouse by binding the mouse event to each node object:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> node = svg.selectAll(<span class="string">".node"</span>)</span><br><span class="line">      .data(graph.nodes)</span><br><span class="line">      .enter().append(<span class="string">"circle"</span>)</span><br><span class="line">      .attr(<span class="string">"class"</span>, <span class="string">"node"</span>)</span><br><span class="line">      .attr(<span class="string">"r"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Math</span>.sqrt(d.size)+<span class="number">1</span>;</span><br><span class="line">      &#125;)</span><br><span class="line">      .style(<span class="string">"fill"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">d</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> color(d.group);</span><br><span class="line">      &#125;)</span><br><span class="line">      .style(<span class="string">"opacity"</span>, <span class="number">0.8</span>)</span><br><span class="line">      .call(force.drag);</span><br></pre></td></tr></table></figure>
<p>And this input device class is implements the same function as the code <strong>.call(force.drag)</strong> in javascript:</p>
<p>First, when our mouse move on the control, will trigger a mouse move event. And for drag a node on the control, a mouse down event will be triggered. When finish the drag, the mouse up event will be triggered.<br>And both of these events have a <strong>MouseEventArgs</strong> parameter, which we can using this argument value for the node detectes and node drags.</p>
<p>From the very beginning, we start to drag a node, then we can set the drag event start and knowing which node is clicked by using <strong>__getNode(Point)</strong> function:<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Canvas_MouseDown(sender <span class="keyword">As</span> <span class="built_in">Object</span>, e <span class="keyword">As</span> MouseEventArgs) <span class="keyword">Handles</span> Canvas.MouseDown</span><br><span class="line">    drag = <span class="literal">True</span></span><br><span class="line">    dragNode = __getNode(e.Location)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure></p>
<p>The <strong>__getNode(Point)</strong> function loops on the nodes in the network, and detected the mouse location is located in which nodes region by using <strong>System.Drawing.Rectangle.Contains(System.Drawing.Point) As Boolean</strong> method, due to the reason of the node location is the location in the data mode, can not be used on the user client directly, so that a function <strong>Canvas.fdgRenderer.GraphToScreen</strong> for the projection between the data model and user interface is used in this function:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Function</span> __getNode(p <span class="keyword">As</span> Point) <span class="keyword">As</span> Node</span><br><span class="line">    <span class="keyword">For</span> <span class="keyword">Each</span> node <span class="keyword">As</span> Node <span class="keyword">In</span> Canvas.Graph.nodes</span><br><span class="line">        <span class="keyword">Dim</span> r <span class="keyword">As</span> <span class="built_in">Single</span> = node.Data.radius</span><br><span class="line">        <span class="keyword">Dim</span> npt <span class="keyword">As</span> Point =</span><br><span class="line">            Canvas.fdgRenderer.GraphToScreen(</span><br><span class="line">            Canvas.fdgPhysics.GetPoint(node).position)</span><br><span class="line">        <span class="keyword">Dim</span> pt <span class="keyword">As</span> <span class="keyword">New</span> Point(npt.X - r / <span class="number">2</span>, npt.Y - r / <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">Dim</span> rect <span class="keyword">As</span> <span class="keyword">New</span> Rectangle(pt, <span class="keyword">New</span> Size(r, r))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">If</span> rect.Contains(p) <span class="keyword">Then</span></span><br><span class="line">            <span class="keyword">Return</span> node</span><br><span class="line">        <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line">    <span class="keyword">Next</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">Return</span> <span class="literal">Nothing</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>
<p>Then by start the mouse move we are able to move the location of the draged node:<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Canvas_MouseMove(sender <span class="keyword">As</span> <span class="built_in">Object</span>, e <span class="keyword">As</span> MouseEventArgs) <span class="keyword">Handles</span> Canvas.MouseMove</span><br><span class="line">    <span class="keyword">If</span> <span class="keyword">Not</span> drag <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Return</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">If</span> dragNode <span class="keyword">IsNot</span> <span class="literal">Nothing</span> <span class="keyword">Then</span></span><br><span class="line">        <span class="keyword">Dim</span> vec <span class="keyword">As</span> FDGVector2 =</span><br><span class="line">                Canvas.fdgRenderer.ScreenToGraph(</span><br><span class="line">                <span class="keyword">New</span> Point(e.Location.X, e.Location.Y))</span><br><span class="line"></span><br><span class="line">        dragNode.Pinned = <span class="literal">True</span></span><br><span class="line">        Canvas.fdgPhysics.GetPoint(dragNode).position = vec</span><br><span class="line">    <span class="keyword">Else</span></span><br><span class="line">        dragNode = __getNode(e.Location)</span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure></p>
<p>If is in the drag mode, then we are set the location of the draged node to the mouse current location, then are we implements the drag events. When we finish the drag event, a mouse up event will be trigged, we release the drag node at here:<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Canvas_MouseUp(sender <span class="keyword">As</span> <span class="built_in">Object</span>, e <span class="keyword">As</span> MouseEventArgs) <span class="keyword">Handles</span> Canvas.MouseUp</span><br><span class="line">    drag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">If</span> dragNode <span class="keyword">IsNot</span> <span class="literal">Nothing</span> <span class="keyword">Then</span></span><br><span class="line">        dragNode.Pinned = <span class="literal">False</span></span><br><span class="line">        dragNode = <span class="literal">Nothing</span></span><br><span class="line">    <span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure></p>
<h5 id="Renderer-for-the-graphics-rendering-of-the-network-data"><a href="#Renderer-for-the-graphics-rendering-of-the-network-data" class="headerlink" title="Renderer for the graphics rendering of the network data"></a>Renderer for the graphics rendering of the network data</h5><p>As we mentioned above, the world between the inner data model and the user interface is different, so that we needs two function for the projection between the inner data model world and the outside user world:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> Projects the data model to our screen for display.</span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;param name="iPos"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Function</span> GraphToScreen(iPos <span class="keyword">As</span> FDGVector2) <span class="keyword">As</span> Point</span><br><span class="line">    <span class="keyword">Dim</span> rect = __regionProvider()</span><br><span class="line">    <span class="keyword">Dim</span> x = <span class="built_in">CInt</span>(Math.Truncate(iPos.x + (<span class="built_in">CSng</span>(rect.Right - rect.Left) / <span class="number">2.0</span>F)))</span><br><span class="line">    <span class="keyword">Dim</span> y = <span class="built_in">CInt</span>(Math.Truncate(iPos.y + (<span class="built_in">CSng</span>(rect.Bottom - rect.Top) / <span class="number">2.0</span>F)))</span><br><span class="line">    <span class="keyword">Return</span> <span class="keyword">New</span> Point(x, y)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> Projects the client graphics data to the data model. </span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;param name="iScreenPos"&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Function</span> ScreenToGraph(iScreenPos <span class="keyword">As</span> Point) <span class="keyword">As</span> FDGVector2</span><br><span class="line">    <span class="keyword">Dim</span> retVec <span class="keyword">As</span> <span class="keyword">New</span> FDGVector2()</span><br><span class="line">    <span class="keyword">Dim</span> rect = __regionProvider()</span><br><span class="line">    retVec.x = <span class="built_in">CSng</span>(iScreenPos.X) - (<span class="built_in">CSng</span>(rect.Right - rect.Left) / <span class="number">2.0</span>F)</span><br><span class="line">    retVec.y = <span class="built_in">CSng</span>(iScreenPos.Y) - (<span class="built_in">CSng</span>(rect.Bottom - rect.Top) / <span class="number">2.0</span>F)</span><br><span class="line">    <span class="keyword">Return</span> retVec</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br></pre></td></tr></table></figure>
<p>And these two project function required of a graphics region on the client controls, which the data source is provides by a lambda expression in the canvas control:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Imports</span> System.Collections.Generic</span><br><span class="line"><span class="keyword">Imports</span> System.Linq</span><br><span class="line"><span class="keyword">Imports</span> System.<span class="keyword">Text</span></span><br><span class="line"><span class="keyword">Imports</span> Microsoft.VisualBasic.DataVisualization.Network.Graph</span><br><span class="line"><span class="keyword">Imports</span> Microsoft.VisualBasic.DataVisualization.Network.Layouts</span><br><span class="line"><span class="keyword">Imports</span> Microsoft.VisualBasic.DataVisualization.Network.Layouts.Interfaces</span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Class</span> Renderer</span><br><span class="line">    <span class="keyword">Inherits</span> AbstractRenderer</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">'''</span> Gets the graphics source</span></span><br><span class="line">    <span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">Dim</span> __graphicsProvider <span class="keyword">As</span> Func(<span class="keyword">Of</span> Graphics)</span><br><span class="line">    <span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">'''</span> gets the graphics region for the projections: <span class="doctag">&lt;see cref="GraphToScreen"/&gt;</span> and <span class="doctag">&lt;see cref="ScreenToGraph"/&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">'''</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">Dim</span> __regionProvider <span class="keyword">As</span> Func(<span class="keyword">Of</span> Rectangle)</span><br></pre></td></tr></table></figure>
<p>The lambda expression in the constructor provides the required client data for the data visualization renderer:</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> __invokeSet(g <span class="keyword">As</span> NetworkGraph)</span><br><span class="line">    net = g</span><br><span class="line">    fdgPhysics = <span class="keyword">New</span> ForceDirected2D(net, FdgArgs.Stiffness, FdgArgs.Repulsion, FdgArgs.Damping)</span><br><span class="line">    fdgRenderer = <span class="keyword">New</span> Renderer(</span><br><span class="line">        <span class="keyword">Function</span>() paper,</span><br><span class="line">        <span class="keyword">Function</span>() <span class="keyword">New</span> Rectangle(<span class="keyword">New</span> Point, Size),</span><br><span class="line">        fdgPhysics)</span><br><span class="line">    inputs = <span class="keyword">New</span> InputDevice(<span class="keyword">Me</span>)</span><br><span class="line">    fdgRenderer.Asynchronous = <span class="literal">False</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br></pre></td></tr></table></figure>
<p>Then by using the <strong>GraphToScreen</strong> function, we are knowing where the node should be draw and using <strong>ScreenToGraph</strong> we can update the draged node its location into the data model.</p>
<p>For draw a edge, we just using the <strong>Graphics.DrawLine(pen As Pen, x1 As Integer, y1 As Integer, x2 As Integer, y2 As Integer)</strong> function, and by using the function <strong>Graphics.FillPie(brush As Brush, rect As Rectangle, startAngle As Single, sweepAngle As Single)</strong> that we can draw a node on the canvas.</p>
<h3 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use?"></a>How to use?</h3><p>Just create a empty form, and then put the canvas control in your form like this:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Imports System.Windows.Forms</span><br><span class="line">Imports Microsoft.VisualBasic.DataVisualization.Network.Canvas</span><br><span class="line">Imports Microsoft.VisualBasic.DataVisualization.Network.FileStream</span><br><span class="line"></span><br><span class="line">Public Class Form1</span><br><span class="line"></span><br><span class="line">    Dim canvas As New Canvas With &#123;</span><br><span class="line">        .Dock = DockStyle.Fill</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Private Sub Form1_Load(sender As Object, e As EventArgs) Handles MyBase.Load</span><br><span class="line">        Call Me.Controls.Add(canvas)</span><br><span class="line"></span><br><span class="line">        canvas.Graph = CytoscapeExportAsGraph(</span><br><span class="line">            App.HOME &amp; "\Resources\xcb-main-Edges.csv",</span><br><span class="line">            App.HOME &amp; "\Resources\xcb-main-Nodes.csv")</span><br><span class="line">    End Sub</span><br><span class="line">End Class</span><br></pre></td></tr></table></figure>
<h3 id="Performance-issue"><a href="#Performance-issue" class="headerlink" title="Performance issue"></a>Performance issue</h3><p>Both VisualBasic and C# have the performance issue of the gdi+ graphics on large image rendering, as all of the gdi+ graphics work is on the CPU. This tools works well on the small network, but it get stuck when trying to rendering a large scale network data, and the graphics display is not so smoothly.</p>
<p>Planning changes the graphics engine from gdi+ to Microsoft Win2D or OpenGL in the future work.</p>
<h3 id="Running-the-Test"><a href="#Running-the-Test" class="headerlink" title="Running the Test"></a>Running the Test</h3><p>The testing project source code can be download from the <a href="https://github.com/xieguigang/VisualBasic_AppFramework/tree/master/Datavisualization/Datavisualization.Network/Test" target="_blank" rel="external">github</a> and here is the <a href="https://github.com/xieguigang/VisualBasic_AppFramework/releases/tag/v0.16-update" target="_blank" rel="external">example release program</a>.<br><img src="https://raw.githubusercontent.com/xieguigang/VisualBasic_AppFramework/master/Datavisualization/Datavisualization.Network/canvas_screenshot.png" alt=""></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://blog.xieguigang.me/2016/06/06/net_canvas/" data-id="cipnbu3e3000d8gv4kfmc7qv3" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    
        <a href="http://blog.xieguigang.me/2016/06/06/net_canvas/#comments" class="article-comment-link disqus-comment-count" data-disqus-url="http://blog.xieguigang.me/2016/06/06/net_canvas/">評論</a>
    

        </footer>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2016/06/07/MergeGthubConflicts/" id="article-nav-newer" class="article-nav-link-wrap">
            <strong class="article-nav-caption">上一篇</strong>
            <div class="article-nav-title">
                
                    Deal with the github merge conflicts
                
            </div>
        </a>
    
    
        <a href="/2016/06/04/nodejs/" id="article-nav-older" class="article-nav-link-wrap">
            <strong class="article-nav-caption">下一篇</strong>
            <div class="article-nav-title">关于NodeJS的单线程和异步IO</div>
        </a>
    
</nav>


    
</article>


    
    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>

</section>
            
                <aside id="sidebar">
   
        
    
        
    <div class="widget-wrap">
        <h3 class="widget-title">歸檔</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a><span class="archive-list-count">22</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">標籤雲</h3>
        <div class="widget tagcloud">
            <a href="/tags/3D/" style="font-size: 10px;">3D</a> <a href="/tags/3d/" style="font-size: 10px;">3d</a> <a href="/tags/3d-graphics/" style="font-size: 10px;">3d graphics</a> <a href="/tags/BI/" style="font-size: 10px;">BI</a> <a href="/tags/CLI/" style="font-size: 10px;">CLI</a> <a href="/tags/Chinese/" style="font-size: 10px;">Chinese</a> <a href="/tags/Chinese-rural-dog/" style="font-size: 10px;">Chinese rural dog</a> <a href="/tags/CodeProject/" style="font-size: 15px;">CodeProject</a> <a href="/tags/Compiler/" style="font-size: 10px;">Compiler</a> <a href="/tags/Desktop/" style="font-size: 10px;">Desktop</a> <a href="/tags/Enigma/" style="font-size: 13.33px;">Enigma</a> <a href="/tags/GCModeller/" style="font-size: 11.67px;">GCModeller</a> <a href="/tags/IE/" style="font-size: 10px;">IE</a> <a href="/tags/Linq/" style="font-size: 10px;">Linq</a> <a href="/tags/MSDN/" style="font-size: 10px;">MSDN</a> <a href="/tags/Markdown/" style="font-size: 10px;">Markdown</a> <a href="/tags/OMIM/" style="font-size: 10px;">OMIM</a> <a href="/tags/PDB/" style="font-size: 10px;">PDB</a> <a href="/tags/Phylostratigraphic/" style="font-size: 10px;">Phylostratigraphic</a> <a href="/tags/R/" style="font-size: 13.33px;">R</a> <a href="/tags/R-squared/" style="font-size: 10px;">R-squared</a> <a href="/tags/SDK-document/" style="font-size: 10px;">SDK document</a> <a href="/tags/SNP/" style="font-size: 10px;">SNP</a> <a href="/tags/SVG/" style="font-size: 10px;">SVG</a> <a href="/tags/Syntax/" style="font-size: 10px;">Syntax</a> <a href="/tags/UI/" style="font-size: 10px;">UI</a> <a href="/tags/VisualStudio/" style="font-size: 10px;">VisualStudio</a> <a href="/tags/WPF/" style="font-size: 10px;">WPF</a> <a href="/tags/XAML/" style="font-size: 10px;">XAML</a> <a href="/tags/YAML/" style="font-size: 10px;">YAML</a> <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a> <a href="/tags/architecture/" style="font-size: 11.67px;">architecture</a> <a href="/tags/art-work/" style="font-size: 10px;">art work</a> <a href="/tags/async/" style="font-size: 10px;">async</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/check-point/" style="font-size: 10px;">check-point</a> <a href="/tags/chrome/" style="font-size: 10px;">chrome</a> <a href="/tags/circos/" style="font-size: 11.67px;">circos</a> <a href="/tags/d3js/" style="font-size: 13.33px;">d3js</a> <a href="/tags/data-analysis/" style="font-size: 10px;">data analysis</a> <a href="/tags/data-visualization/" style="font-size: 10px;">data visualization</a> <a href="/tags/desktop/" style="font-size: 10px;">desktop</a> <a href="/tags/document/" style="font-size: 10px;">document</a> <a href="/tags/elementary-os/" style="font-size: 10px;">elementary os</a> <a href="/tags/firefox/" style="font-size: 10px;">firefox</a> <a href="/tags/force-directed/" style="font-size: 10px;">force directed</a> <a href="/tags/gdi/" style="font-size: 11.67px;">gdi+</a> <a href="/tags/genetics/" style="font-size: 13.33px;">genetics</a> <a href="/tags/github/" style="font-size: 13.33px;">github</a> <a href="/tags/heatmap/" style="font-size: 10px;">heatmap</a> <a href="/tags/interface/" style="font-size: 10px;">interface</a> <a href="/tags/javascript/" style="font-size: 16.67px;">javascript</a> <a href="/tags/jquery/" style="font-size: 10px;">jquery</a> <a href="/tags/language/" style="font-size: 10px;">language</a> <a href="/tags/languages/" style="font-size: 10px;">languages</a> <a href="/tags/libzplay/" style="font-size: 10px;">libzplay</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/music/" style="font-size: 16.67px;">music</a> <a href="/tags/my-works/" style="font-size: 10px;">my works</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/nodejs/" style="font-size: 10px;">nodejs</a> <a href="/tags/note/" style="font-size: 18.33px;">note</a> <a href="/tags/open-source/" style="font-size: 10px;">open-source</a> <a href="/tags/perl/" style="font-size: 10px;">perl</a> <a href="/tags/pipeline/" style="font-size: 10px;">pipeline</a> <a href="/tags/re0/" style="font-size: 10px;">re0</a> <a href="/tags/rem/" style="font-size: 10px;">rem</a> <a href="/tags/repost/" style="font-size: 16.67px;">repost</a> <a href="/tags/statics/" style="font-size: 10px;">statics</a> <a href="/tags/svg/" style="font-size: 10px;">svg</a> <a href="/tags/threading/" style="font-size: 10px;">threading</a> <a href="/tags/threadpool/" style="font-size: 10px;">threadpool</a> <a href="/tags/tricks/" style="font-size: 10px;">tricks</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/user-agent/" style="font-size: 10px;">user-agent</a> <a href="/tags/vb-net/" style="font-size: 20px;">vb.net</a> <a href="/tags/web/" style="font-size: 10px;">web</a> <a href="/tags/web-api/" style="font-size: 10px;">web api</a> <a href="/tags/web-server/" style="font-size: 10px;">web server</a> <a href="/tags/win10/" style="font-size: 10px;">win10</a> <a href="/tags/works/" style="font-size: 10px;">works</a> <a href="/tags/中華田園犬/" style="font-size: 10px;">中華田園犬</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a> <a href="/tags/前端设计/" style="font-size: 13.33px;">前端设计</a> <a href="/tags/数据视图/" style="font-size: 10px;">数据视图</a> <a href="/tags/架构/" style="font-size: 11.67px;">架构</a> <a href="/tags/架构设计/" style="font-size: 10px;">架构设计</a> <a href="/tags/线程池/" style="font-size: 10px;">线程池</a> <a href="/tags/转载/" style="font-size: 10px;">转载</a> <a href="/tags/转载搬运/" style="font-size: 16.67px;">转载搬运</a> <a href="/tags/鹿乃/" style="font-size: 10px;">鹿乃</a>
        </div>
    </div>

    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">連結</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://framework-docs.xieguigang.me/">VisualBasic Framework</a>
                    </li>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
                    <li>
                        <a href="http://gcmodeller.org">http://gcmodeller.org</a>
                    </li>
                
                    <li>
                        <a href="https://github.com/genetics-potato">https://github.com/genetics-potato</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>
            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2016 しゃけい よしつな<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_config = function () {
        
            this.page.url = 'http://blog.xieguigang.me/2016/06/06/net_canvas/';
        
        this.page.identifier = 'net_canvas';
    };
    (function() { 
        var d = document, s = d.createElement('script');  
        s.src = '//' + 'xieguigang' + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>



    
        <script src="/vendor/fancybox/jquery.fancybox.pack.js"></script>
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>